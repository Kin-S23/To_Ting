<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blessings For You</title>
   
    <script src="https://cdn.tailwindcss.com"></script>
    
  
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF69B4',
                    },
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .puzzle-piece {
                cursor: grab;
                transition: all 0.3s ease;
                box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            }
            .puzzle-piece:active {
                cursor: grabbing;
            }
            .drop-zone {
                border: 2px dashed #9ca3af; 
                transition: all 0.3s ease;
                
                background: transparent;
            }
            .drop-zone.filled {
                border: none; 
            }
            .completed-flash {
                animation: flash 1s ease-in-out 3;
            }
            @keyframes flash {
                0%, 100% { opacity: 1; transform: scale(1); }
                50% { opacity: 0.7; transform: scale(1.02); }
            }
            .arrow-appear {
                animation: slideUp 0.5s ease-out forwards;
            }
            @keyframes slideUp {
                from { transform: translateY(20px); opacity: 0; }
                to { transform: translateY(0); opacity: 1; }
            }
        }
    </style>
</head>
<body class="bg-gray-100 flex justify-center items-center min-h-screen p-4 overflow-hidden">
    <div class="w-full max-w-6xl mx-auto flex flex-col items-center">
       
        <div id="puzzle-container" class="w-full max-w-md mx-auto aspect-square">
            <div id="puzzle-board" class="w-full h-full grid grid-cols-4 grid-rows-4 gap-0 transition-all duration-500">
               
            </div>
        </div>
        
       
        <div id="pieces-container" class="w-full flex justify-between items-center mt-6 px-2">
            <div id="pieces-left" class="flex flex-wrap gap-3 justify-center">
               
            </div>
            <div id="pieces-right" class="flex flex-wrap gap-3 justify-center">
               
            </div>

        </div>
        <div id="blessing-text" class="hidden text-center mt-6">
    <span class="text-2xl font-bold text-pink-500 opacity-0 transition-opacity duration-1000；">Blessings for you</span>
</div>
        
       
        <div id="arrow-container" class="hidden flex justify-center mt-8">
            <a href="/To_Ting20251213/index0.html" class="arrow-appear">
                <img src="/To_Ting20251213/arrowhead.png" alt="前往下一页" class="w-16 h-auto cursor-pointer hover:scale-110 transition-transform">
            </a>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
           
            const PUZZLE_SIZE = 4; 
            const PIECES_COUNT = PUZZLE_SIZE * PUZZLE_SIZE;
            const SNAP_DISTANCE = 30; 
            
          
            const puzzleBoard = document.getElementById('puzzle-board');
            const piecesLeft = document.getElementById('pieces-left');
            const piecesRight = document.getElementById('pieces-right');
            const arrowContainer = document.getElementById('arrow-container');
            const puzzleContainer = document.getElementById('puzzle-container');
            
            const blessingText = document.getElementById('blessing-text');
    const blessingSpan = blessingText ? blessingText.querySelector('span') : null; 
    
            
            let placedPieces = 0;
            
            let puzzleBoardSize = puzzleBoard.offsetWidth;
            const pieceSize = Math.floor(puzzleBoardSize / PUZZLE_SIZE); 
            
            
            for (let i = 0; i < PIECES_COUNT; i++) {
                const col = i % PUZZLE_SIZE;
                const row = Math.floor(i / PUZZLE_SIZE);
                
                const dropZone = document.createElement('div');
                dropZone.classList.add('drop-zone', 'relative', 'overflow-hidden');
                dropZone.dataset.index = i;
                dropZone.dataset.col = col;
                dropZone.dataset.row = row;
                
                dropZone.style.width = `${pieceSize}px`;
                dropZone.style.height = `${pieceSize}px`;
                
                puzzleBoard.appendChild(dropZone);
            }
            
           
            const shuffledIndices = Array.from({length: PIECES_COUNT}, (_, i) => i)
                .sort(() => Math.random() - 0.5);
            
            const midPoint = Math.ceil(shuffledIndices.length / 2);
            const leftPieces = shuffledIndices.slice(0, midPoint);
            const rightPieces = shuffledIndices.slice(midPoint);
            
            
            function createPiece(index, container) {
                const col = index % PUZZLE_SIZE;
                const row = Math.floor(index / PUZZLE_SIZE);
                
                const piece = document.createElement('div');

                piece.style.width = `${pieceSize}px`;
                piece.style.height = `${pieceSize}px`;
                piece.classList.add('puzzle-piece', 'bg-gray-200');
                piece.dataset.index = index;
                piece.dataset.col = col;
                piece.dataset.row = row;
                
               
                piece.style.backgroundImage = `url('/To_Ting20251213/pink_bear.png')`;
                piece.style.backgroundSize = `${puzzleBoardSize}px ${puzzleBoardSize}px`; 
                piece.style.backgroundPosition = `-${col * pieceSize}px -${row * pieceSize}px`;
                piece.style.backgroundRepeat = 'no-repeat';
                
               
                piece.draggable = true;
                
                
                piece.addEventListener('dragstart', handleDragStart);
                
                container.appendChild(piece);
            }
            
            
            setTimeout(() => {
                
                puzzleBoardSize = puzzleBoard.offsetWidth;
                createPieceIndices(leftPieces, piecesLeft);
                createPieceIndices(rightPieces, piecesRight);
            }, 100);
            
            
            function createPieceIndices(indices, container) {
                indices.forEach(index => {
                    const col = index % PUZZLE_SIZE;
                    const row = Math.floor(index / PUZZLE_SIZE);
                    
                    const piece = document.createElement('div');
                    piece.style.width = `${pieceSize}px`;
                    piece.style.height = `${pieceSize}px`;
                    piece.classList.add('puzzle-piece', 'bg-gray-200');
                    piece.dataset.index = index;
                    piece.dataset.col = col;
                    piece.dataset.row = row;
                    
                    piece.style.backgroundImage = `url('/To_Ting20251213/pink_bear.png')`;
                    piece.style.backgroundSize = `${puzzleBoardSize}px ${puzzleBoardSize}px`;
                    piece.style.backgroundPosition = `-${col * pieceSize}px -${row * pieceSize}px`;
                    piece.style.backgroundRepeat = 'no-repeat';
                    
                    piece.draggable = true;
                    piece.addEventListener('dragstart', handleDragStart);
                    
                    container.appendChild(piece);
                });
            }
            
           
            document.querySelectorAll('.drop-zone').forEach(zone => {
                zone.addEventListener('dragover', handleDragOver);
                zone.addEventListener('dragleave', handleDragLeave);
                zone.addEventListener('drop', handleDrop);
            });
            
           
            function handleDragStart(e) {
                e.dataTransfer.setData('text/plain', this.dataset.index);
                setTimeout(() => this.classList.add('opacity-60', 'scale-95'), 0);
            }
            
         
            function handleDragOver(e) {
                e.preventDefault();
             
            }
           
            function handleDragLeave() {
                
            }
            
           
            function handleDrop(e) {
                e.preventDefault();
                
                
                if (this.hasChildNodes()) return;
                
                const pieceIndex = e.dataTransfer.getData('text/plain');
                const piece = document.querySelector(`.puzzle-piece[data-index="${pieceIndex}"]`);
                
               
                if (!piece) return;
                
               
                const targetIndex = parseInt(this.dataset.index);
                const pieceIndexNum = parseInt(pieceIndex);
                
               
                const pieceRect = piece.getBoundingClientRect();
                const zoneRect = this.getBoundingClientRect();
                
                
                const pieceCenterX = pieceRect.left + pieceRect.width / 2;
                const pieceCenterY = pieceRect.top + pieceRect.height / 2;
                const zoneCenterX = zoneRect.left + zoneRect.width / 2;
                const zoneCenterY = zoneRect.top + zoneRect.height / 2;
                
                const distance = Math.sqrt(
                    Math.pow(pieceCenterX - zoneCenterX, 2) + 
                    Math.pow(pieceCenterY - zoneCenterY, 2)
                );
                
              
                if (pieceIndexNum === targetIndex || distance < SNAP_DISTANCE) {
                   
                    const clonedPiece = piece.cloneNode(true);
                    clonedPiece.classList.remove('opacity-60', 'scale-95');
                    clonedPiece.draggable = false;
                    clonedPiece.style.width = '100%';
                    clonedPiece.style.height = '100%';
                   
                    clonedPiece.style.backgroundSize = `${PUZZLE_SIZE * 100}% ${PUZZLE_SIZE * 100}%`;
                    clonedPiece.style.backgroundPosition = `${(parseInt(clonedPiece.dataset.col) / 3) * 100}% ${(parseInt(clonedPiece.dataset.row) / 3) * 100}%`;
                    clonedPiece.classList.add('absolute', 'inset-0');
                    
                    piece.remove();
                    
                    this.appendChild(clonedPiece);
                    this.classList.add('filled');
                    
                    placedPieces++;
                    
                    if (placedPieces === PIECES_COUNT) {
                        completePuzzle();
                    }
                }
            }
            
            function completePuzzle() {
                document.querySelectorAll('.drop-zone').forEach(zone => {
                    zone.classList.remove('drop-zone', 'filled');
                    zone.style.border = 'none';
                });
                
                const completeImage = document.createElement('div');
                completeImage.classList.add('w-full', 'h-full', 'completed-flash', 'relative');
                completeImage.style.width = `${puzzleBoard.offsetWidth}px`;
                completeImage.style.height = `${puzzleBoard.offsetHeight}px`;
                completeImage.style.backgroundImage = `url('/To_Ting20251213/pink_bear.png')`;
                completeImage.style.backgroundSize = '100% 100%';
                completeImage.style.backgroundRepeat = 'no-repeat';
                completeImage.style.backgroundPosition = 'center';
                
                puzzleBoard.innerHTML = '';
                puzzleBoard.appendChild(completeImage);
                
                document.getElementById('pieces-container').classList.add('hidden');
                
                setTimeout(() => {
                    arrowContainer.classList.remove('hidden');
        if (blessingText && blessingSpan) {
            blessingText.classList.remove('hidden');
            setTimeout(() => {
                blessingSpan.style.opacity = '1';
            }, 100);
        }
                }, 3000); 
            }
            
            window.addEventListener('resize', () => {
                location.reload();
            });
        });
    </script>
</body>

</html>

